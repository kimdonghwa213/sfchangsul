{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „ë¶ ê¹€ì œ ìŠ¤ë§ˆíŠ¸íŒœ í˜ì‹ ë°¸ë¦¬ ì‹¤ì¦ë‹¨ì§€</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        // OrbitControlsë¥¼ THREE ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì¶”ê°€
        if (typeof THREE !== 'undefined' && typeof THREE.OrbitControls === 'undefined') {
            THREE.OrbitControls = window.OrbitControls || function() {};
        }
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #e8dcc8;
            padding: 0;
        }

        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1.2fr 1fr;
            gap: 20px;
            padding: 30px;
            background: #e8dcc8;
            min-height: 100vh;
        }

        .section-header {
            background: #1a4a5a;
            color: white;
            padding: 12px 15px;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            font-size: 16px;
            text-align: center;
        }

        .section-container {
            display: flex;
            flex-direction: column;
        }

        .farm-section {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .farm-card {
            border: 2px solid #1a4a5a;
            padding: 15px;
            margin: 15px;
            border-radius: 8px;
            background: #f9f7f5;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .farm-card:hover {
            background: #f0e8e0;
            transform: translateX(3px);
        }

        .farm-number {
            background: #1a4a5a;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .farm-name {
            font-weight: 600;
            color: #1a3a47;
            font-size: 12px;
            margin-bottom: 6px;
        }

        .farm-company {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
        }

        .farm-detail {
            font-size: 10px;
            color: #999;
            line-height: 1.4;
        }

        .equipment-section {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        .equipment-card {
            border: 2px solid #1a4a5a;
            padding: 15px;
            margin: 12px;
            border-radius: 6px;
            background: #f9f7f5;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .equipment-card:hover {
            background: #f0e8e0;
        }

        .equipment-number {
            background: #1a4a5a;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 6px;
            font-size: 12px;
        }

        .equipment-name {
            font-weight: 600;
            color: #1a3a47;
            font-size: 11px;
            margin-bottom: 4px;
        }

        .equipment-detail {
            font-size: 9px;
            color: #999;
            line-height: 1.3;
        }

        .facility-section {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .facility-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 15px;
        }

        .facility-item {
            background: #d4dfe6;
            border: 2px solid #a8c5d1;
            border-radius: 6px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .facility-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .facility-item.large {
            grid-column: span 2;
        }

        .facility-number {
            font-weight: bold;
            color: #1a3a47;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .facility-text {
            font-size: 11px;
            color: #555;
            line-height: 1.3;
        }

        .greenhouse-section {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        .greenhouse-card {
            border: 2px solid #1a4a5a;
            padding: 12px;
            margin: 10px;
            border-radius: 6px;
            background: #f9f7f5;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .greenhouse-card:hover {
            background: #f0e8e0;
        }

        .greenhouse-number {
            background: #5a3a7a;
            color: white;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 11px;
        }

        .greenhouse-name {
            font-weight: 600;
            color: #1a3a47;
            font-size: 11px;
            margin-bottom: 3px;
        }

        .greenhouse-detail {
            font-size: 9px;
            color: #999;
            line-height: 1.2;
        }

        .info-box {
            background: #f0ebdc;
            border-left: 4px solid #8b7355;
            padding: 12px;
            margin: 10px;
            border-radius: 6px;
            font-size: 11px;
        }

        .info-label {
            color: #666;
            margin-bottom: 3px;
        }

        .info-title {
            font-weight: bold;
            color: #1a3a47;
            font-size: 12px;
            margin-bottom: 6px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-top: 6px;
        }

        .info-item {
            text-align: center;
            background: white;
            padding: 6px;
            border-radius: 4px;
        }

        .info-count {
            font-size: 16px;
            font-weight: bold;
            color: #1a4a5a;
        }

        .info-text {
            font-size: 9px;
            color: #666;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 10px;
            width: 90%;
            max-width: 1200px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #2d6f7f 0%, #1a4a57 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 10px 10px 0 0;
        }

        .modal-header h2 {
            font-size: 24px;
            margin: 0;
        }

        .close-btn {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
        }

        .modal-body {
            padding: 30px;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .modal-viewer {
            background: #1a1a1a;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            min-height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #canvas3d {
            width: 100%;
            height: 100%;
            display: block;
        }

        .viewer-placeholder {
            text-align: center;
            color: #999;
            width: 100%;
        }

        .viewer-placeholder h3 {
            margin-bottom: 20px;
            color: #2d6f7f;
            font-size: 18px;
        }

        .robot-controls {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .robot-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #2d6f7f;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #999;
            animation: pulse 1s infinite;
        }

        .status-indicator.active {
            background: #4CAF50;
        }

        .status-indicator.scanning {
            background: #FF9800;
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-text {
            font-size: 12px;
            color: #666;
        }

        .scan-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #2d6f7f 0%, #1a4a57 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .scan-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(45, 111, 127, 0.4);
        }

        .scan-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2d6f7f 0%, #4CAF50 100%);
            border-radius: 2px;
            animation: progress 2s ease-in-out infinite;
        }

        @keyframes progress {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        .modal-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .info-section {
            background: white;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }

        .info-section h3 {
            color: #2d6f7f;
            font-size: 13px;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #2d6f7f;
        }

        .info-section p {
            font-size: 12px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 5px;
        }
    </style>
</head>
<!-- Core theme CSS (includes Bootstrap)-->
        <link href="{% static 'single_pages/css/styles.css' %}" rel="stylesheet" />
        <link rel="stylesheet" href="{% static 'single_pages/bootstrap/bootstrap.min.css' %}" media="screen">
<body>
<!-- ë„¤ë¹„ê²Œì´ì…˜ë°” -->
{% include "single_pages/navbar.html" %}
<!-- ê¸°ë³¸ í…œí”Œë¦¿ ì•ˆì— ì‚½ì…ë  ë‚´ìš© Start -->
{% block content %}
{% endblock %}
    <div class="main-container">
        <div class="section-container">
            <div class="section-header">ë†ì§€</div>
            <div class="farm-section">
                <div class="farm-card" onclick="open3DModal(25)">
                    <div class="farm-number">25</div>
                    <div class="farm-name">ë…¸ì§€í† ê²½, 400ã¡</div>
                    <div class="farm-company">ë¯¸ë˜ë†ì‚¬</div>
                    <div class="farm-detail">
                        â—‹ ë…¸ì§€ ê´€ìˆ˜ì‹œìŠ¤í…œ<br>
                        â—‹ 2022.12.01 ~ 2026.12.31(49ê°œì›”)
                    </div>
                </div>
                <div class="farm-card" onclick="open3DModal(24)">
                    <div class="farm-number">24</div>
                    <div class="farm-name">ë…¸ì§€í† ê²½, 200ã¡</div>
                    <div class="farm-company">í…Œë¼ì›¨ì´ë¸Œ</div>
                    <div class="farm-detail">
                        â—‹ ìˆœí™˜í˜• ì‘ë¬¼ì¬ë°° ì‹œìŠ¤í…œ<br>
                        â—‹ 2023.10.01 ~ 2025.11.30(26ê°œì›”)
                    </div>
                </div>
                <div class="farm-card" onclick="open3DModal(23)">
                    <div class="farm-number">23</div>
                    <div class="farm-name">ë…¸ì§€í† ê²½, 200ã¡</div>
                    <div class="farm-company">ê¸ˆí™”ì´ì—”ì—ìŠ¤</div>
                    <div class="farm-detail">
                        â—‹ ì—ë„ˆì§€íš¨ìœ¨í™” ì»¨í…Œì´ë„ˆíŒœ<br>
                        â—‹ 2025.03.01 ~ 2027.12.31(34ê°œì›”)
                    </div>
                </div>
                <div class="farm-card" onclick="open3DModal(22)">
                    <div class="farm-number">22</div>
                    <div class="farm-name">ë…¸ì§€í† ê²½, 200ã¡</div>
                    <div class="farm-company">ì„±í˜¸ì—ì´í…</div>
                    <div class="farm-detail">
                        â—‹ ë³µí•©í™˜ê²½ì œì–´ê¸°<br>
                        â—‹ 2022.12.01 ~ 2026.12.31(49ê°œì›”)
                    </div>
                </div>
                <div class="farm-card" onclick="open3DModal(21)">
                    <div class="farm-number">21</div>
                    <div class="farm-name">ë…¸ì§€í† ê²½, 200ã¡</div>
                    <div class="farm-company">í•œêµ­ë„ì‹œë†ì—…</div>
                    <div class="farm-detail">
                        â—‹ ìˆ˜ì§ë“€ì–¼ìˆ˜ì§í˜•ë†ì¥<br>
                        â—‹ 2022.12.01 ~ 2026.12.31(49ê°œì›”)
                    </div>
                </div>
            </div>
        </div>

        <div class="section-container">
            <div class="section-header">ì—°ë™ ë¹„ë‹ì˜¨ì‹¤</div>
            <div class="equipment-section">
                <div class="equipment-card" onclick="open3DModal(5)">
                    <div class="equipment-number">5</div>
                    <div class="equipment-name">í–‰ì‰ë² ë“œ, 840ã¡</div>
                    <div class="farm-company">ëˆ„ë¶€ì‹ ìì—°ì• ë°”ì´ì˜¤</div>
                    <div class="equipment-detail">
                        â—‹ ìœ ê¸°íƒœ ë¹„ë£Œ í™œìš© ìƒìœ¡ ìµœì í™”<br>
                        â—‹ 2025.05.01 ~ 2027.12.31(32ê°œì›”)
                    </div>
                </div>
                <div class="equipment-card" onclick="open3DModal(11)">
                    <div class="equipment-number">11</div>
                    <div class="equipment-name">í–‰ì‰ë² ë“œ, 840ã¡</div>
                    <div class="farm-company">ì„±í˜¸ì—ìŠ¤ì•„ì´ì½”í¼ë ˆì´ì…˜</div>
                    <div class="equipment-detail">
                        â—‹ ì˜ìƒë¶„ì„ì‹œìŠ¤í…œ, ë³µí•©í™˜ê²½ì œì–´ê¸°<br>
                        â—‹ 2022.06.01 ~ 2026.12.31(55ê°œì›”)
                    </div>
                </div>
            </div>
        </div>

        <div class="section-container">
            <div class="section-header" style="background: #5a7a6a;">ìœ ë¦¬ì˜¨ì‹¤</div>
            <div class="facility-section">
                <div class="facility-grid">
                    <div class="facility-item large" style="grid-column: span 2; background: #c0ccc8; border-color: #a0b0ac;">
                        ì‹œì„¤ë³´ìˆ˜
                    </div>

                    <div class="facility-item" onclick="open3DModal(6)">
                        <div>
                            <div class="facility-number">6</div>
                            <div class="facility-text">ë²¤ì¹˜ë² ë“œ<br>420ã¡</div>
                        </div>
                    </div>
                    <div class="facility-item" onclick="open3DModal(7)">
                        <div>
                            <div class="facility-number">7</div>
                            <div class="facility-text">ë²¤ì¹˜ë² ë“œ<br>420ã¡</div>
                        </div>
                    </div>
                    <div class="facility-item" onclick="open3DModal(8)">
                        <div>
                            <div class="facility-number">8</div>
                            <div class="facility-text">í–‰ì‰ë² ë“œ<br>420ã¡</div>
                        </div>
                    </div>
                    <div class="facility-item" onclick="open3DModal(9)">
                        <div>
                            <div class="facility-number">9</div>
                            <div class="facility-text">í–‰ì‰ë² ë“œ<br>420ã¡</div>
                        </div>
                    </div>
                    <div class="facility-item" onclick="open3DModal(10)">
                        <div>
                            <div class="facility-number">10</div>
                            <div class="facility-text">í–‰ì‰ë² ë“œ<br>420ã¡</div>
                        </div>
                    </div>

                    <div class="facility-item large" onclick="open3DModal(12)" style="background: #b0c0bc; border-color: #90a0ac;">
                        <div>
                            <div class="facility-number">12</div>
                            <div class="facility-text">í–‰ì‰ë² ë“œ, 1,260ã¡</div>
                        </div>
                    </div>
                    <div class="facility-item large" onclick="open3DModal(13)" style="background: #b0c0bc; border-color: #90a0ac;">
                        <div>
                            <div class="facility-number">13</div>
                            <div class="facility-text">í–‰ì‰ë² ë“œ, 1,260ã¡</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section-container">
            <div class="section-header" style="background: #5a3a7a;">ë‹¨ë™ ë¹„ë‹ì˜¨ì‹¤</div>
            <div class="greenhouse-section">
                <div class="greenhouse-card" onclick="open3DModal(14)">
                    <div class="greenhouse-number">14</div>
                    <div class="greenhouse-name">ê³ ì„¤ë² ë“œ</div>
                    <div class="greenhouse-detail">
                        í¬ë„<br>
                        â—‹ ì˜ìƒê¸°ë°˜í’ˆì§ˆ ë° ìƒìœ¡ì¸¡ì • ëª¨ë¸<br>
                        â—‹ 2025.01.01 ~ 2027.12.31(36ê°œì›”)
                    </div>
                </div>
                <div class="greenhouse-card" onclick="open3DModal(15)">
                    <div class="greenhouse-number">15</div>
                    <div class="greenhouse-name">ê³ ì„¤ë² ë“œ</div>
                    <div class="greenhouse-detail">
                        í•´ì •ê¸€ë¡œë²Œ<br>
                        â—‹ íƒ„ì†Œë³µí•©ë² ë“œ<br>
                        â—‹ 2024.05.01 ~ 2025.11.30(19ê°œì›”)
                    </div>
                </div>
                <div class="greenhouse-card" onclick="open3DModal(16)">
                    <div class="greenhouse-number">16</div>
                    <div class="greenhouse-name">ë…¸ì§€í† ê²½, 217ã¡</div>
                    <div class="greenhouse-detail">
                        ëŒ€ì„±<br>
                        â—‹ ì–‘ë´‰ì‹œìŠ¤í…œ<br>
                        â—‹ 2022.04.01 ~ 2026.12.31(57ê°œì›”)
                    </div>
                </div>
                <div class="greenhouse-card" onclick="open3DModal(17)">
                    <div class="greenhouse-number">17</div>
                    <div class="greenhouse-name">ë…¸ì§€í† ê²½, 186ã¡</div>
                    <div class="greenhouse-detail">
                        ì˜¤ë¸Œì œë°”ì´ì˜¤<br>
                        â—‹ ë°”ë‚˜ë‚˜ ë‚´ìƒê·  ë°œêµ´<br>
                        â—‹ 2025.03.01 ~ 2027.12.31(34ê°œì›”)
                    </div>
                </div>
                <div class="greenhouse-card" onclick="open3DModal(18)">
                    <div class="greenhouse-number">18</div>
                    <div class="greenhouse-name">ë…¸ì§€í† ê²½, 186ã¡</div>
                    <div class="greenhouse-detail">
                        ì—ìŠ¤ì—ìŠ¤ì—˜<br>
                        â—‹ ì˜¨ì‹¤ììœ¨ì œì–´ì‹œìŠ¤í…œ<br>
                        â—‹ 2023.04.01 ~ 2025.11.30(32ê°œì›”)
                    </div>
                </div>

                <div class="info-box">
                    <div class="info-label">ì‹¤/ì¦/í˜„/í™©</div>
                    <div class="info-title">ê¸°ì¤€ì¼ì: 2025.5.1.</div>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">ì…ì£¼ê¸°ì—…</div>
                            <div class="info-count">8</div>
                            <div class="info-text">ç¤¾</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ìœ„íƒí˜•</div>
                            <div class="info-count">10</div>
                            <div class="info-text">ç¤¾</div>
                        </div>
                    </div>
                    <div style="text-align: center; padding-top: 8px; border-top: 1px solid #e0e0e0; margin-top: 8px;">
                        <div class="info-label">ììœ¨í˜•</div>
                        <div class="info-count">16</div>
                        <div class="info-text">ç¤¾</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal3D" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">ì˜¨ì‹¤ #6 - 3D ìŠ¤ìº”</h2>
                <button class="close-btn" onclick="close3DModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-viewer" id="modelViewer">
                    <div class="viewer-placeholder">
                        <h3>ğŸ¤– ììœ¨ì£¼í–‰ ë¡œë´‡ ìŠ¤ìº” ì‹œìŠ¤í…œ</h3>
                        <p style="margin: 20px 0; color: #aaa; font-size: 14px;">ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¡œë´‡ì„ ì‹¤í–‰í•˜ì„¸ìš”</p>
                    </div>
                </div>
                <div class="modal-info">
                    <div class="robot-controls">
                        <div class="robot-status">
                            <div class="status-indicator" id="robotIndicator"></div>
                            <div class="status-text">
                                <strong>ë¡œë´‡ ìƒíƒœ:</strong> <span id="robotStatus">ëŒ€ê¸°ì¤‘</span>
                            </div>
                        </div>
                        <button class="scan-button" id="scanBtn" onclick="startRobotScan()">
                            ğŸ¤– ì‹¤ì‹œê°„ ìŠ¤ìº” ì‹œì‘
                        </button>
                        <div style="display: none;" id="progressContainer">
                            <p style="font-size: 12px; color: #666; margin-bottom: 8px;" id="progressText">ë¡œë´‡ ì´ë™ ì¤‘...</p>
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                        </div>
                    </div>

                    <div class="info-section">
                        <h3>ì˜¨ì‹¤ ì •ë³´</h3>
                        <p><strong>ì˜¨ì‹¤ëª…:</strong> <span id="infoName">-</span></p>
                        <p><strong>ë©´ì :</strong> <span id="infoArea">-</span></p>
                        <p><strong>ìš´ì˜ì‚¬:</strong> <span id="infoCompany">-</span></p>
                    </div>

                    <div class="info-section">
                        <h3>ìš´ì˜ ê¸°ê°„</h3>
                        <p id="infoPeriod">-</p>
                    </div>
                    <div class="info-section" id="detailsSection" style="display: none;">
                        <h3>ì‹œì„¤ ì •ë³´</h3>
                        <p id="infoDetails" style="white-space: pre-line;">-</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Django Static íŒŒì¼ ê²½ë¡œë¥¼ JavaScript ë³€ìˆ˜ë¡œ ì§€ì •
        const STATIC_MODELS_URL = "{% static 'single_pages/models/' %}";
        console.log("=== Static URL í™•ì¸ ===");
        console.log("STATIC_MODELS_URL:", STATIC_MODELS_URL);

        const buildingData = {
            5: { name: "í–‰ì‰ë² ë“œ #5", area: "840ã¡", company: "ëˆˆë¶€ì‹ ìì—°ì• ë°”ì´ì˜¤", period: "2025.05.01 ~ 2027.12.31", details: "â—‹ ìœ ë™íœ€ ìˆ˜: 4ê°œ\n â—‹ ë² ë“œ(í–‰ì‰): 15ê°œ" },
            6: { name: "ë²¤ì¹˜ë² ë“œ #6", area: "420ã¡", company: "ë°”ì´ì˜¤íë¸Œì‹œìŠ¤í…œ", period: "2024.04.01 ~ 2025.11.30", details: "â—‹ ìœ ë™íœ€ ìˆ˜: 2ê°œ\nâ—‹ ë² ë“œ(ë²¤ì¹˜): 6ê°œ" },
            7: { name: "ë²¤ì¹˜ë² ë“œ #7", area: "420ã¡", company: "ì„¸ì¸ì‹í’ˆ, ëŒ€ì¼êµ­ì œì¢…ë¬˜", period: "2024.05.01 ~ 2027.04.30", details: "â—‹ ìœ ë™íœ€ ìˆ˜: 2ê°œ\nâ—‹ ë² ë“œ(ë²¤ì¹˜): 6ê°œ" },
            8: { name: "í–‰ì‰ë² ë“œ #8", area: "420ã¡", company: "í¬ë¡œí”„íŠ¸", period: "2025.01.01 ~ 2027.12.31", details: "â—‹ ìœ ë™íœ€ ìˆ˜: 2ê°œ\nâ—‹ ë² ë“œ(í–‰ì‰): 9ê°œ" },
            9: { name: "í–‰ì‰ë² ë“œ #9", area: "420ã¡", company: "ì”¨ë“œì—í”„ì•„ì´ì”¨", period: "2024.05.01 ~ 2027.12.31", details: "â—‹ ìœ ë™íœ€ ìˆ˜: 2ê°œ\nâ—‹ ë² ë“œ(í–‰ì‰): 9ê°œ" },
            10: { name: "í–‰ì‰ë² ë“œ #10", area: "420ã¡", company: "êµìœ¡ìš©ì˜¨ì‹¤", period: "", details: "â—‹ ìœ ë™íœ€ ìˆ˜: 2ê°œ\nâ—‹ ë² ë“œ(í–‰ì‰): 9ê°œ" },
            11: { name: "í–‰ì‰ë² ë“œ #11", area: "840ã¡", company: "ì„±í˜¸ì—ìŠ¤ì•„ì´ì½”í¼ë ˆì´ì…˜", period: "2022.06.01 ~ 2026.12.31", details: "â—‹ ìœ ë™íœ€ ìˆ˜: 4ê°œ\nâ—‹ ë² ë“œ(í–‰ì‰): 15ê°œ" },
            12: { name: "í–‰ì‰ë² ë“œ #12", area: "1,260ã¡", company: "ê¸ˆí™”ì´ì—”ì—ìŠ¤", period: "2023.02.01 ~ 2025.11.30", details: "â—‹ ìœ ë™íœ€ ìˆ˜: 6ê°œ\nâ—‹ ë² ë“œ(í–‰ì‰): 24ê°œ" },
            13: { name: "í–‰ì‰ë² ë“œ #13", area: "1,260ã¡", company: "ì—ìŠ¤ì—ìŠ¤ì—˜", period: "2025.01.01 ~ 2027.12.31", details: "â—‹ ìœ ë™íœ€ ìˆ˜: 6ê°œ\nâ—‹ ë² ë“œ(í–‰ì‰): 24ê°œ" },
            14: { name: "ê³ ì„¤ë² ë“œ #14", area: "217ã¡", company: "í¬ë„", period: "2025.01.01 ~ 2027.12.31" },
            15: { name: "ê³ ì„¤ë² ë“œ #15", area: "217ã¡", company: "í—¤ì •ê¸€ë¡œë²Œ", period: "2024.05.01 ~ 2025.11.30" },
            16: { name: "ë…¸ì§€í† ê²½ #16", area: "217ã¡", company: "ëŒ€ì„±", period: "2022.04.01 ~ 2026.12.31" },
            17: { name: "ë…¸ì§€í† ê²½ #17", area: "186ã¡", company: "ì˜¤ë¸Œì œë°”ì´ì˜¤", period: "2025.03.01 ~ 2027.12.31" },
            18: { name: "ë…¸ì§€í† ê²½ #18", area: "186ã¡", company: "ì—ìŠ¤ì—ìŠ¤ì—˜", period: "2023.04.01 ~ 2025.11.30" },
            21: { name: "ë…¸ì§€í† ê²½ #21", area: "200ã¡", company: "í•œêµ­ë„ì‹œë†ì—…", period: "2022.12.01 ~ 2026.12.31" },
            22: { name: "ë…¸ì§€í† ê²½ #22", area: "200ã¡", company: "ì„±í˜¸ì—ì´í…", period: "2022.12.01 ~ 2026.12.31" },
            23: { name: "ë…¸ì§€í† ê²½ #23", area: "200ã¡", company: "ê¸ˆí™”ì´ì—”ì—ìŠ¤", period: "2025.03.01 ~ 2027.12.31" },
            24: { name: "ë…¸ì§€í† ê²½ #24", area: "200ã¡", company: "í…Œë¼ì›¨ì´ë¸Œ", period: "2023.10.01 ~ 2025.11.30" },
            25: { name: "ë…¸ì§€í† ê²½ #25", area: "400ã¡", company: "ë¯¸ë˜ì„¼ì„œ", period: "2022.12.01 ~ 2026.12.31" }
        };

        let scene, camera, renderer, currentModel, controls;
        let isScanning = false;

        function initThreeJS() {
            const container = document.getElementById('modelViewer');

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a1a);

            const width = container.clientWidth;
            const height = container.clientHeight;

            camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
            camera.position.set(0, 2, 8);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(width, height);
            renderer.setPixelRatio(window.devicePixelRatio);

            const existingCanvas = container.querySelector('canvas');
            if (existingCanvas) {
                container.removeChild(existingCanvas);
            }
            container.appendChild(renderer.domElement);

            // OrbitControls ì´ˆê¸°í™”
            if (window.THREE.OrbitControls) {
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.minDistance = 3;
                controls.maxDistance = 20;
            } else {
                console.warn('OrbitControlsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
            }

            // ì¡°ëª… ì¶”ê°€
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 7);
            scene.add(directionalLight);

            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
            directionalLight2.position.set(-5, 5, -7);
            scene.add(directionalLight2);

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);

            if (controls) {
                controls.update();
            }

            renderer.render(scene, camera);
        }

        function open3DModal(buildingNumber) {
            const data = buildingData[buildingNumber];
            const modal = document.getElementById('modal3D');

            document.getElementById('modalTitle').textContent = `${data.name} - 3D ìŠ¤ìº”`;
            document.getElementById('infoName').textContent = data.name;
            document.getElementById('infoArea').textContent = data.area;
            document.getElementById('infoCompany').textContent = data.company;
            document.getElementById('infoPeriod').textContent = data.period;

             // ìƒì„¸ ì •ë³´ê°€ ìˆëŠ” ê²½ìš° (5~13ë²ˆ ì˜¨ì‹¤)
            if (data.details) {
                document.getElementById('detailsSection').style.display = 'block';
                document.getElementById('infoDetails').textContent = data.details;
            } else {
                document.getElementById('detailsSection').style.display = 'none';
            }

            modal.style.display = 'block';

            setTimeout(() => {
                if (!renderer) {
                    initThreeJS();
                }
            }, 100);

            const viewer = document.getElementById('modelViewer');
            viewer.innerHTML = `
                <div class="viewer-placeholder">
                    <h3>ğŸ¤– ììœ¨ì£¼í–‰ ë¡œë´‡ ìŠ¤ìº” ì‹œìŠ¤í…œ</h3>
                    <p style="margin: 20px 0; color: #aaa; font-size: 14px;">ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¡œë´‡ì„ ì‹¤í–‰í•˜ì„¸ìš”</p>
                </div>
            `;
            document.getElementById('robotIndicator').classList.remove('active', 'scanning');
            document.getElementById('robotStatus').textContent = 'ëŒ€ê¸°ì¤‘';
            document.getElementById('scanBtn').disabled = false;
        }

        function close3DModal() {
            const modal = document.getElementById('modal3D');
            modal.style.display = 'none';
            isScanning = false;
            document.getElementById('robotIndicator').classList.remove('scanning');
            document.getElementById('robotStatus').textContent = 'ëŒ€ê¸°ì¤‘';

            if (currentModel) {
                scene.remove(currentModel);
                currentModel = null;
            }
        }

        const modelMap = {
            5: '3d_scan1.glb',
            6: '3d_scan1.glb',
            7: '3d_scan1.glb',
            8: '3d_scan1.glb',
            9: '3d_scan1.glb',
            10: '3d_scan1.glb',
            11: '3d_scan1.glb',
            12: '3d_scan1.glb',
            13: '3d_scan1.glb',
            14: '3d_scan1.glb',
            15: '3d_scan1.glb',
            16: '3d_scan1.glb',
            17: '3d_scan1.glb',
            18: '3d_scan1.glb',
            21: '3d_scan2.glb',
            22: '3d_scan2.glb',
            23: '3d_scan2.glb',
            24: '3d_scan2.glb',
            25: '3d_scan2.glb'
        };

        function startRobotScan() {
            if (isScanning) return;

            isScanning = true;

            const scanBtn = document.getElementById('scanBtn');
            const indicator = document.getElementById('robotIndicator');
            const statusText = document.getElementById('robotStatus');
            const progressContainer = document.getElementById('progressContainer');

            scanBtn.disabled = true;
            indicator.classList.add('scanning');
            statusText.textContent = 'ì´ë™ ì¤‘...';
            progressContainer.style.display = 'block';

            let progress = 0;
            const scanInterval = setInterval(() => {
                progress += Math.random() * 15;

                if (progress >= 100) {
                    clearInterval(scanInterval);

                    statusText.textContent = 'ìŠ¤ìº” ë°ì´í„° ì²˜ë¦¬ ì¤‘...';

                    setTimeout(() => {
                        const modalTitle = document.getElementById('modalTitle').textContent;
                        const buildingNumMatch = modalTitle.match(/#(\d+)/);
                        const buildingNum = buildingNumMatch ? parseInt(buildingNumMatch[1]) : null;

                        console.log("=== ëª¨ë¸ ë¡œë“œ ì‹œì‘ ===");
                        console.log("Building Number:", buildingNum);

                        let modelFile = modelMap[buildingNum];
                        const defaultModel = 'greenhouse_8.glb';

                        const modelUrl = modelFile ?
                                         `${STATIC_MODELS_URL}${modelFile}` :
                                         `${STATIC_MODELS_URL}${defaultModel}`;

                        console.log('ìµœì¢… ëª¨ë¸ URL:', modelUrl);

                        loadRemote3DModel(modelUrl);

                        statusText.textContent = 'ì™„ë£Œ';
                        indicator.classList.remove('scanning');
                        indicator.classList.add('active');
                        progressContainer.style.display = 'none';

                        setTimeout(() => {
                            scanBtn.disabled = false;
                            isScanning = false;
                            statusText.textContent = 'ëŒ€ê¸°ì¤‘';
                            indicator.classList.remove('active');
                        }, 2000);
                    }, 1500);
                } else {
                    document.getElementById('progressText').textContent = `ë¡œë´‡ ìŠ¤ìº” ì§„í–‰ì¤‘... ${Math.floor(progress)}%`;
                }
            }, 300);
        }

        function loadRemote3DModel(fileUrl) {
            console.log("=== loadRemote3DModel í˜¸ì¶œ ===");
            console.log("íŒŒì¼ URL:", fileUrl);

            if (!fileUrl) {
                console.error('ìœ íš¨í•œ URLì´ í•„ìš”í•©ë‹ˆë‹¤');
                return;
            }

            if (currentModel) {
                scene.remove(currentModel);
                currentModel = null;
            }

            const viewer = document.getElementById('modelViewer');

            viewer.innerHTML = `
                <div class="viewer-placeholder">
                    <h3>ğŸ“¦ 3D ëª¨ë¸ ë¡œë“œ ì¤‘...</h3>
                    <div class="progress-bar" style="margin-top: 20px;">
                        <div class="progress-fill" style="animation: none; width: 50%;"></div>
                    </div>
                </div>
            `;

            if (typeof THREE.GLTFLoader === 'undefined') {
                 console.error("GLTFLoaderê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                 viewer.innerHTML = `
                    <div class="viewer-placeholder">
                        <h3>âŒ GLTFLoader ì˜¤ë¥˜</h3>
                        <p style="color: #ff6b6b;">Three.js GLTFLoaderê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                 return;
            }

            const loader = new THREE.GLTFLoader();

            loader.load(
                fileUrl,
                (gltf) => {
                    console.log("âœ… ëª¨ë¸ ë¡œë“œ ì„±ê³µ!");

                    viewer.innerHTML = '';
                    viewer.appendChild(renderer.domElement);

                    currentModel = gltf.scene;
                    scene.add(currentModel);

                    const box = new THREE.Box3().setFromObject(currentModel);
                    const size = box.getSize(new THREE.Vector3());
                    const center = box.getCenter(new THREE.Vector3());
                    const maxDim = Math.max(size.x, size.y, size.z);
                    const scale = 5 / maxDim;

                    currentModel.scale.multiplyScalar(scale);

                    const scaledCenter = new THREE.Vector3(
                        center.x * scale,
                        center.y * scale,
                        center.z * scale
                    );
                    currentModel.position.sub(scaledCenter);

                    camera.position.set(0, 2, maxDim * 1.5 * scale);
                    camera.lookAt(currentModel.position);

                    if (controls) {
                        controls.target.copy(currentModel.position);
                        controls.update();
                    }

                    console.log('ëª¨ë¸ í¬ê¸°:', size);
                    console.log('ìŠ¤ì¼€ì¼:', scale);
                },
                (xhr) => {
                    if (xhr.lengthComputable) {
                        const percentComplete = (xhr.loaded / xhr.total) * 100;
                        const progressBar = viewer.querySelector('.progress-fill');
                        if (progressBar) {
                            progressBar.style.width = percentComplete.toFixed(0) + '%';
                        }
                        console.log('ëª¨ë¸ ë¡œë“œ ì¤‘: ' + percentComplete.toFixed(0) + '%');
                    }
                },
                (error) => {
                    console.error('âŒ ëª¨ë¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                    viewer.innerHTML = `
                        <div class="viewer-placeholder">
                            <h3>âŒ ëª¨ë¸ ë¡œë“œ ì‹¤íŒ¨</h3>
                            <p style="margin: 15px 0; color: #ff6b6b;">
                                íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
                                URL: ${fileUrl}
                            </p>
                            <p style="font-size: 12px; color: #999;">${error.message || error}</p>
                            <p style="font-size: 11px; color: #666; margin-top: 15px;">
                                í™•ì¸ì‚¬í•­:<br>
                                1. static/single_pages/models/greenhouse_8.glb íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€<br>
                                2. Django collectstatic ëª…ë ¹ì„ ì‹¤í–‰í–ˆëŠ”ì§€<br>
                                3. ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ë„¤íŠ¸ì›Œí¬ íƒ­ì„ í™•ì¸
                            </p>
                        </div>
                    `;
                }
            );
        }

        window.onclick = function(event) {
            const modal = document.getElementById('modal3D');
            if (event.target == modal) {
                close3DModal();
            }
        }

        window.addEventListener('resize', () => {
            if (renderer) {
                const container = document.getElementById('modelViewer');
                const width = container.clientWidth;
                const height = container.clientHeight;

                camera.aspect = width / height;
                camera.updateProjectionMatrix();
                renderer.setSize(width, height);
            }
        });
    </script>
</body>
</html>